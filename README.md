# E0102
UCSD Affiliated Research Project Studying Supernova Dust Production in the Small Magellanic Cloud.  
  This project is written by Bethany A Ludwig and advised by Dr. Karin Sandstrom.
  - This is the abridged version. Code has been simplified to save space and to reflect only decisions chosen to remain in the final paper.  
  - Other methods that were tested but ultimately not used are not contained in this version.  
  - For a more complete version please email the author. 
## Additional Required Dependencies. 
To run code from scratch, you must install opencv and reproject.
```
pip install opencv-python reproject
```
*Assuming python3, may be slightly different for 2.7
** Note that reproject can be less than predictiable on Windows but appears to run fine on linux.
## Original Files
Contains Infrared images from Spitzer and Herschel which are the primary observations for this project.  
  Also contains images of E0102 in the Radio and Xray for boundary determination. 
## Saturation Correction
The Spitzer 24 micron image has an oversaturated source far away from the remnant that disrupts convolution. 
  This code simply replaces that source with a box of NaNs. 
## Sky Remove
A region in each image at 24 microns (Spitzer) and 70, 100, 160 microns (Herschel) is selected that contains the least (closest to 0) amount of emission in the images while avoiding the edges. The region contains the same RA/DEC coordinates in each image. The median is taken of this region and subtracted from each image. The standard deviation of this region is saved and used later as a source of error during the SED fitting. 
## Convolve/Regrid
Folder contains all Kernels used for convolution. Kernels obtained from [Aniano+,2011](https://arxiv.org/abs/1106.5065).  
Convolve.py is a convolution module where the master_convolve function can be called in other scripts. The process ensures that the Kernel is equal to one, the max value of the Kernel is in the center, the Kernel array is square. This code isn't built to handle rotation but does flag a warning if rotation needs to be accounted for (i.e. CD1_2 and CD2_1 are nonzero.) This code also doesn't work on rare Kernels that do not contain a single peak intensity in the center. 
## Mask Creation
Mask coordinates are obtained using Chandra Xray data of E0102 at 1100-2000 eV. The data is convolved to the appropriate resolution. The canny edge detection algorithm from opencv2 is used to get the coordinates. The mask is then extended 20 pixels to the left to avoid overcompensating for emission-line nebula N76 during background removal.
## Background Removal
E0102 is located within a spatially variable background that must be considered before any measurements can take place.    
The four data points we are using to make the measurement include images at 24 microns (Spitzer) and 70, 100, 160 microns (Herschel).        
### Inpainting
For the 24 and 70 micron images the resolution is good enough that we employ a non linear diffusion based inpainting method to model the background before removing it from the supernova. We apply an iterative solution to Laplaceâ€™s equation using backward finite difference  in  time  and  second  order  central  difference  inspace. I.e.:    
![equation](https://latex.codecogs.com/gif.latex?\frac{dx(i,j,t)}{dt}-\alpha\nabla^2x(i,j,t)=0)
Note that the fits files and movies generated by the code in Background_Removal/Diffusion is not included in this repo to save space. If running from scratch new folders with the correct names will need to be created as they are currently being ignored (folder names can be found in the .gitignore file). Diffusion.py would need to be run before any of the other scripts and does take a while (~30min) to run. This script creates the final modeled background image where the other files are used for visualizing and understanding the results.
### Bootstrap
Because the 100 and 160 micron images have poorer resolution than 24 and 70, the inpainting method converges too fast and another method should be utilized. We solve for a scale factor between the 100 and 160 images and the 70 micron modeled background. 
The scale factor we solve for is based on the median of the ratio of an annulus around the supernova in the background to an annulus around the supernova in the image we are modeling. 
![equation](https://latex.codecogs.com/gif.latex?100&space;\mu&space;m&space;\text{&space;Background}=&space;70&space;\mu&space;m&space;\text{&space;Background}&space;\times&space;\Big(\frac{100\mu\text{m&space;Image}&space;}{70&space;\mu&space;m\text{&space;Background}&space;}\Big)_{Med})
## SED Fitting
## Final Files
This folder contains the background removed images and those images regridded and convolved to match the resolution of the 160 micron image. It also contains code for plotting those images in Plot.py
